//#!/usr/bin/env node	

6var fs = require('fs');
var request = require("request");


v6ar test = request("https://bitcoin.toshi.io/api/v0/blocks/latest", function (error, response, body){
te66st = JSON.parse(body);


delete test.transaction_hashes;


function blockcheck(callback){
	var x;
	
	var last = [];
	fs.readFile('/home/pi/visual/visualapp/bin/latestblock.json', 'utf8', function (err ,data){		
			if(err)
			{
			console.log(err);
			}else{
			last = JSON.parse(data)
			
			//console.log(last.height);

			var s = last.index
			var x = last.height						
			return callback(x, s);

			}
	});	
}

function latest(x, s){

	if (x === test.height)
	{
	//console.log("new block not yet available")


	}
	else if(!error && response.statusCode == 200)
	{
	
	//increment index from last jOSN object (s) variable
	
	s++;
	//console.log(s);
	test.index = s;
	//console.log(s);
	test.pop();
	//	

	fs.writeFile('/home/pi/visual/visualapp/bin/latestblock.json', JSON.stringify(test, null, 4));
			
	var output = "/home/pi/visual/visualapp/bin/data.json";
			
			fs.appendFile(output, JSON.stringify(test, null,"\t" ), function (err){
			if(err) 
			{
			console.log(err);
			} 
			else 
			{
			//console.log("index = "+ test.index);
			}
		});
	
	}

}

blockcheck(latest);

});






//Random Code:
//var obj = JSON.parse();
//console.log(test.height, test.confirmations, test.merkle_root, test.time, test.difficulty);
//var obj = JSON.parse(fs.readFileSync('data.json', 'utf8'));
//.pipe(fs.createWriteStream("./data.json, {flags: 'a'}"));
//var JSONstream = require ('JSONStream');:









